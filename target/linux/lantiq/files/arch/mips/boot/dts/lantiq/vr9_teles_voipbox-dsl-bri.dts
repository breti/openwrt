#include "vr9.dtsi"

#include <dt-bindings/input/input.h>
#include <dt-bindings/mips/lantiq_rcu_gphy.h>

/ {
	compatible = "teles,voipbox-dsl-bri", "lantiq,xway", "lantiq,vr9";
	model = "Teles VoIPBox DSL 2/4/8";

	chosen {
		bootargs = "console=ttyLTQ0,115200";
	};

	aliases {
		led-boot = &system;
		led-failsafe = &system;
		led-running = &system;
		led-upgrade = &system;

		led-dsl = &dsl;
		led-lan = &lan;
	};

	memory@0 {
		device_type = "memory";
		reg = <0x0 0x4000000>;
	};

	leds {
		compatible = "gpio-leds";

                system: system {
                        label = "green:system";
                        gpios = <&gpio 35 GPIO_ACTIVE_LOW>;
                };

                dsl: dsl {
                        label = "green:dsl";
                        gpios = <&gpio 36 GPIO_ACTIVE_LOW>;
                };

                lan: lan {
                        label = "green:lan";
                        gpios = <&gpio 37 GPIO_ACTIVE_LOW>;
                };
	};
};

&eth0 {
	pinctrl-0 = <&mdio_pins>,
		<&gphy0_led0_pins>, <&gphy0_led1_pins>, <&gphy0_led2_pins>,
		<&gphy1_led0_pins>, <&gphy1_led1_pins>, <&gphy1_led2_pins>;

	interface@0 {
		compatible = "lantiq,xrx200-pdi";
		#address-cells = <1>;
		#size-cells = <0>;
		reg = <0>;
		lantiq,switch;

		ethernet@2 {
			compatible = "lantiq,xrx200-pdi-port";
			reg = <2>;
			phy-mode = "gmii";
			phy-handle = <&phy11>;
		};

		ethernet@4 {
			compatible = "lantiq,xrx200-pdi-port";
			reg = <4>;
			phy-mode = "gmii";
			phy-handle = <&phy13>;
		};
	};

	mdio@0 {
		#address-cells = <1>;
		#size-cells = <0>;
		compatible = "lantiq,xrx200-mdio";

		/* https://lwn.net/Articles/688391/ */
		/* led0 left red - led1 left green - led2 right amber */
		/* Left LED: Red on - 1000 Mbps; Green on - 100 Mbps; off - 10 Mbps */
		/* Right LED: Amber on - link established; Amber blinking - Activity; off - no link established */
                phy11: ethernet-phy@11 {
                        reg = <0x11>;
                        compatible = "lantiq,phy11g", "ethernet-phy-ieee802.3-c22";
			lantiq,led0h = <0x40>;
                        lantiq,led0l = <0x00>;
                        lantiq,led1h = <0x20>;
                        lantiq,led1l = <0x00>;
                        lantiq,led2h = <0x70>;
                        lantiq,led2l = <0x03>;
                };
                phy13: ethernet-phy@13 {
                        reg = <0x13>;
                        compatible = "lantiq,phy11g", "ethernet-phy-ieee802.3-c22";
			lantiq,led0h = <0x40>;
                        lantiq,led0l = <0x00>;
                        lantiq,led1h = <0x20>;
                        lantiq,led1l = <0x00>;
                        lantiq,led2h = <0x70>;
                        lantiq,led2l = <0x03>;
                };
	};
};

&gphy0 {
	lantiq,gphy-mode = <GPHY_MODE_GE>;
};

&gphy1 {
	lantiq,gphy-mode = <GPHY_MODE_GE>;
};

&localbus {
	nor@0 {
		compatible = "lantiq,nor";
		bank-width = <2>;
		reg = <0 0x0 0x2000000>;
		#address-cells = <1>;
		#size-cells = <1>;

		/* https://forum.openwrt.org/t/adding-openwrt-support-for-teles-voipbox-dsl-lantiq-vr9/93010/8?u=breti */
		partitions {
			compatible = "fixed-partitions";
			#address-cells = <1>;
			#size-cells = <1>;

			partition@0 {
				label = "uboot";
				reg = <0x0 0x20000>; /* 128 kB */
				read-only;
			};

			partition@20000 {
				label = "gphy_firmware";
				reg = <0x20000 0x20000>; /* 128 kB */
				read-only;
			};

			partition@40000 {
				label = "firmware";
				reg = <0x40000 0x100000>; /* 1 MB */
				read-only;
			};

			partition@140000 {
				label = "kernel";
				reg = <0x140000 0x680000>; /* 6.8 MB */
			};

			partition@7c0000 {
				label = "sysconfig";
				reg = <0x7c0000 0x20000>; /* 128 kB */
				read-only;
			};

			partition@7e0000 {
				label = "ubootconfig";
				reg = <0x7e0000 0x20000>; /* 128 kB */
				read-only;
			};
			partition@800000 {
				label = "ubi";
				reg = <0x800000 0x1800000>; /* 25 MB */
			};
		};
	};
};

&pcie0 {
        status = "disabled";
};

